<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>پروفایل فروشنده</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .footer {
      background-color: #f2f2f2;
      color: #333;
      text-align: center;
      padding: 1em 0;
      font-size: 0.9rem;
      border-top: 1px solid #ddd;
      direction: rtl;
    }
    .footer a {
      color: #0077cc;
      text-decoration: none;
      font-weight: bold;
    }
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body class="bg-gray-100 p-6 font-sans">

  <!-- ناوبری -->
  <nav class="bg-blue-600 text-white p-4 rounded mb-6 flex justify-between items-center">
    <div class="text-xl font-bold">فروشگاه احسان</div>
    <div class="space-x-4 space-x-reverse">
      <a href="index.html" class="hover:underline">🛒 فروش</a>
      <a href="products.html" class="hover:underline">📦 محصولات</a>
      <a href="customers.html" class="hover:underline">👥 مشتریان</a>
      <a href="history.html" class="hover:underline">📜 تاریخچه</a>
      <a href="profile.html" class="hover:underline font-bold">👤 پروفایل</a>
    </div>
  </nav>

  <div class="max-w-4xl mx-auto space-y-6">

    <!-- پروفایل فروشنده (به‌روزرسانی شده) -->
    <div class="bg-white p-4 rounded-lg shadow flex items-center gap-4 border-r-4 border-blue-600">
      <img
        src="https://ehsan-hashemi.ir/icon.jpeg"
        alt="عکس پروفایل"
        class="w-24 h-24 rounded-full border-2 border-blue-500 object-cover"
      >
      <div class="flex-1 text-left">
        <div class="text-xl font-semibold text-gray-800">سید محمد احسان هاشمی</div>
        <br>
        <div class="text-sm text-gray-600">فروشگاه احسان</div>
        <div class="mt-2 flex space-x-4 rtl:space-x-reverse text-xs text-gray-500">
          <div>📞 09143654519</div>
          <div>🆔 001et23fg</div>
        </div>
      </div>
    </div>

    <!-- آمار روزانه -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-4 text-center">📈 آمار روزانه</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="bg-blue-100 p-4 rounded">
          <div class="text-lg font-semibold">خریدهای امروز</div>
          <div id="statDayOrders" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-yellow-100 p-4 rounded">
          <div class="text-lg font-semibold">مشتریان امروز</div>
          <div id="statDayCustomers" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-green-100 p-4 rounded">
          <div class="text-lg font-semibold">درآمد امروز (ریال)</div>
          <div id="statDayRevenue" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-purple-100 p-4 rounded">
          <div class="text-lg font-semibold">سود امروز (ریال)</div>
          <div id="statDayProfit" class="text-2xl font-bold">۰</div>
        </div>
      </div>
    </div>

    <!-- آمار ماهانه -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-4 text-center">📊 آمار ماهانه</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="bg-blue-100 p-4 rounded">
          <div class="text-lg font-semibold">خریدهای این ماه</div>
          <div id="statMonthOrders" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-yellow-100 p-4 rounded">
          <div class="text-lg font-semibold">مشتریان این ماه</div>
          <div id="statMonthCustomers" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-green-100 p-4 rounded">
          <div class="text-lg font-semibold">درآمد این ماه (ریال)</div>
          <div id="statMonthRevenue" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-purple-100 p-4 rounded">
          <div class="text-lg font-semibold">سود این ماه (ریال)</div>
          <div id="statMonthProfit" class="text-2xl font-bold">۰</div>
        </div>
      </div>
    </div>

    <!-- آمار سالانه -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-4 text-center">📅 آمار سالانه</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="bg-blue-100 p-4 rounded">
          <div class="text-lg font-semibold">خریدهای امسال</div>
          <div id="statYearOrders" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-yellow-100 p-4 rounded">
          <div class="text-lg font-semibold">مشتریان امسال</div>
          <div id="statYearCustomers" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-green-100 p-4 rounded">
          <div class="text-lg font-semibold">درآمد امسال (ریال)</div>
          <div id="statYearRevenue" class="text-2xl font-bold">۰</div>
        </div>
        <div class="bg-purple-100 p-4 rounded">
          <div class="text-lg font-semibold">سود امسال (ریال)</div>
          <div id="statYearProfit" class="text-2xl font-bold">۰</div>
        </div>
      </div>
    </div>

    <!-- آمار کل مشتریان -->
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <div class="text-xl font-semibold">👥 کل مشتریان</div>
      <div id="statTotalCustomers" class="text-3xl font-bold mt-2">۰</div>
    </div>

  </div>

  <footer class="footer mt-6">
    <p style="direction: ltr">
      &copy; <span id="year">2025</span> همه حقوق محفوظ است.
      <a href="https://your-website.com" target="_blank">نام شما</a>
    </p>
  </footer>

  <script>
    // بارگذاری خریدها از LocalStorage
    const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');

    function computeStats() {
      const now = new Date();
      const dayStart   = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).getTime();
      const yearStart  = new Date(now.getFullYear(), 0, 1).getTime();

      // فیلترها
      const dayList   = purchases.filter(p => p.timestamp >= dayStart);
      const monthList = purchases.filter(p => p.timestamp >= monthStart);
      const yearList  = purchases.filter(p => p.timestamp >= yearStart);

      // منطق محاسبه
      function stats(list) {
        const orders   = list.length;
        const customers= new Set(list.map(p => p.phone || '')).size;
        const revenue  = list.reduce((sum, p) => sum + (p.total || 0), 0);
        const profit   = list.reduce((sum, p) => {
          const base = p.items.reduce((s, it) => s + (it.price || 0) * (it.quantity || 1), 0);
          return sum + ((p.total || 0) - base);
        }, 0);
        return { orders, customers, revenue, profit };
      }

      const d = stats(dayList);
      const m = stats(monthList);
      const y = stats(yearList);
      const totalCustomers = new Set(purchases.map(p => p.phone||'')).size;

      // نمایش
      document.getElementById('statDayOrders')   .textContent = d.orders;
      document.getElementById('statDayCustomers').textContent = d.customers;
      document.getElementById('statDayRevenue')  .textContent = d.revenue.toLocaleString();
      document.getElementById('statDayProfit')   .textContent = d.profit.toLocaleString();

      document.getElementById('statMonthOrders')   .textContent = m.orders;
      document.getElementById('statMonthCustomers').textContent = m.customers;
      document.getElementById('statMonthRevenue')  .textContent = m.revenue.toLocaleString();
      document.getElementById('statMonthProfit')   .textContent = m.profit.toLocaleString();

      document.getElementById('statYearOrders')   .textContent = y.orders;
      document.getElementById('statYearCustomers').textContent = y.customers;
      document.getElementById('statYearRevenue')  .textContent = y.revenue.toLocaleString();
      document.getElementById('statYearProfit')   .textContent = y.profit.toLocaleString();

      document.getElementById('statTotalCustomers').textContent = totalCustomers;
      document.getElementById('year')           .textContent = now.getFullYear();
    }

    document.addEventListener('DOMContentLoaded', computeStats);
  </script>
</body>
</html>
